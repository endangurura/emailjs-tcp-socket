"use strict";

var _windowsSocket = _interopRequireDefault(require("./windows-socket"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/* eslint-disable no-unused-expressions */
describe('TCPSocket Windows Stream Socket unit tests', function () {
  var socket;
  before(function () {
    global.Windows = {
      Networking: {
        HostName: function HostName(hostname) {
          this.type = hostname;
          this.hostname = hostname;
        },
        Sockets: {
          StreamSocket: function StreamSocket() {
            var _this = this;

            this.control = {};
            this.inputStream = {
              type: 'inputStream'
            };
            this.outputStream = {
              type: 'outputStream'
            };

            this.connectAsync = function (host, port, protection) {
              _this.host = host;
              _this.port = port;
              _this.protection = protection;
              return {
                done: function done(successCb) {
                  return setImmediate(successCb);
                }
              };
            };
          },
          SocketProtectionLevel: {
            plainSocket: 1,
            tls12: 2
          }
        }
      },
      Storage: {
        Streams: {
          DataReader: function DataReader(stream) {
            var _this2 = this;

            this.type = 'DataReader';
            this.stream = stream;
            this.inputStreamOptions = false;
            this._bytes = false;

            this.loadAsync = function () {
              return {
                done: function done(successCb) {
                  return setImmediate(function () {
                    return successCb(_this2._bytes && _this2._bytes.length || 0);
                  });
                }
              };
            };

            this.readBytes = function (target) {
              for (var i = 0, len = _this2._bytes.length; i < len; i++) {
                target[i] = _this2._bytes[i];
              }

              _this2._bytes = false;
            };
          },
          DataWriter: function DataWriter(stream) {
            var _this3 = this;

            this.type = 'DataWriter';
            this.stream = stream;
            this.inputStreamOptions = false;
            this._bytes = false;

            this.writeBytes = function (data) {
              _this3._bytes = data;
            };

            this.storeAsync = function () {
              return {
                done: function done(successCb) {
                  return setImmediate(successCb);
                }
              };
            };
          },
          InputStreamOptions: {
            partial: 3
          }
        }
      }
    };
  });
  beforeEach(function (done) {
    socket = _windowsSocket["default"].open('127.0.0.1', 9000, {
      useSecureTransport: false
    });
    expect(socket).to.exist;

    socket.onopen = function () {
      done();
    };
  });
  describe('open and read', function () {
    it('should read data from socket', function (done) {
      socket.ondata = function (e) {
        expect(new Uint8Array(e.data)).to.deep.equal(new Uint8Array([0, 1, 2]));
        socket.close();
      };

      socket.onclose = function () {
        return done();
      };

      socket._dataReader._bytes = new Uint8Array([0, 1, 2]);
    });
  });
  describe('close', function () {
    it('should work', function (done) {
      socket.onclose = function () {
        expect(socket.readyState).to.equal('closed');
        done();
      };

      socket.close();
    });
  });
  describe('send', function () {
    it('should send data to socket', function (done) {
      socket.ondrain = function () {
        socket.close();
      };

      socket.onclose = function () {
        return done();
      };

      socket.send(new Uint8Array([0, 1, 2]).buffer);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy93aW5kb3dzLXNvY2tldC11bml0LmpzIl0sIm5hbWVzIjpbImRlc2NyaWJlIiwic29ja2V0IiwiYmVmb3JlIiwiZ2xvYmFsIiwiV2luZG93cyIsIk5ldHdvcmtpbmciLCJIb3N0TmFtZSIsImhvc3RuYW1lIiwidHlwZSIsIlNvY2tldHMiLCJTdHJlYW1Tb2NrZXQiLCJjb250cm9sIiwiaW5wdXRTdHJlYW0iLCJvdXRwdXRTdHJlYW0iLCJjb25uZWN0QXN5bmMiLCJob3N0IiwicG9ydCIsInByb3RlY3Rpb24iLCJkb25lIiwic3VjY2Vzc0NiIiwic2V0SW1tZWRpYXRlIiwiU29ja2V0UHJvdGVjdGlvbkxldmVsIiwicGxhaW5Tb2NrZXQiLCJ0bHMxMiIsIlN0b3JhZ2UiLCJTdHJlYW1zIiwiRGF0YVJlYWRlciIsInN0cmVhbSIsImlucHV0U3RyZWFtT3B0aW9ucyIsIl9ieXRlcyIsImxvYWRBc3luYyIsImxlbmd0aCIsInJlYWRCeXRlcyIsInRhcmdldCIsImkiLCJsZW4iLCJEYXRhV3JpdGVyIiwid3JpdGVCeXRlcyIsImRhdGEiLCJzdG9yZUFzeW5jIiwiSW5wdXRTdHJlYW1PcHRpb25zIiwicGFydGlhbCIsImJlZm9yZUVhY2giLCJUY3BTb2NrZXQiLCJvcGVuIiwidXNlU2VjdXJlVHJhbnNwb3J0IiwiZXhwZWN0IiwidG8iLCJleGlzdCIsIm9ub3BlbiIsIml0Iiwib25kYXRhIiwiZSIsIlVpbnQ4QXJyYXkiLCJkZWVwIiwiZXF1YWwiLCJjbG9zZSIsIm9uY2xvc2UiLCJfZGF0YVJlYWRlciIsInJlYWR5U3RhdGUiLCJvbmRyYWluIiwic2VuZCIsImJ1ZmZlciJdLCJtYXBwaW5ncyI6Ijs7QUFFQTs7OztBQUZBO0FBSUFBLFFBQVEsQ0FBQyw0Q0FBRCxFQUErQyxZQUFZO0FBQ2pFLE1BQUlDLE1BQUo7QUFFQUMsRUFBQUEsTUFBTSxDQUFDLFlBQU07QUFDWEMsSUFBQUEsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2ZDLE1BQUFBLFVBQVUsRUFBRTtBQUNWQyxRQUFBQSxRQUFRLEVBQUUsa0JBQVVDLFFBQVYsRUFBb0I7QUFDNUIsZUFBS0MsSUFBTCxHQUFZRCxRQUFaO0FBQ0EsZUFBS0EsUUFBTCxHQUFnQkEsUUFBaEI7QUFDRCxTQUpTO0FBS1ZFLFFBQUFBLE9BQU8sRUFBRTtBQUNQQyxVQUFBQSxZQUFZLEVBQUUsd0JBQVk7QUFBQTs7QUFDeEIsaUJBQUtDLE9BQUwsR0FBZSxFQUFmO0FBRUEsaUJBQUtDLFdBQUwsR0FBbUI7QUFDakJKLGNBQUFBLElBQUksRUFBRTtBQURXLGFBQW5CO0FBSUEsaUJBQUtLLFlBQUwsR0FBb0I7QUFDbEJMLGNBQUFBLElBQUksRUFBRTtBQURZLGFBQXBCOztBQUlBLGlCQUFLTSxZQUFMLEdBQW9CLFVBQUNDLElBQUQsRUFBT0MsSUFBUCxFQUFhQyxVQUFiLEVBQTRCO0FBQzlDLGNBQUEsS0FBSSxDQUFDRixJQUFMLEdBQVlBLElBQVo7QUFDQSxjQUFBLEtBQUksQ0FBQ0MsSUFBTCxHQUFZQSxJQUFaO0FBQ0EsY0FBQSxLQUFJLENBQUNDLFVBQUwsR0FBa0JBLFVBQWxCO0FBQ0EscUJBQU87QUFDTEMsZ0JBQUFBLElBQUksRUFBRSxjQUFBQyxTQUFTO0FBQUEseUJBQUlDLFlBQVksQ0FBQ0QsU0FBRCxDQUFoQjtBQUFBO0FBRFYsZUFBUDtBQUdELGFBUEQ7QUFRRCxXQXBCTTtBQXFCUEUsVUFBQUEscUJBQXFCLEVBQUU7QUFDckJDLFlBQUFBLFdBQVcsRUFBRSxDQURRO0FBRXJCQyxZQUFBQSxLQUFLLEVBQUU7QUFGYztBQXJCaEI7QUFMQyxPQURHO0FBaUNmQyxNQUFBQSxPQUFPLEVBQUU7QUFDUEMsUUFBQUEsT0FBTyxFQUFFO0FBQ1BDLFVBQUFBLFVBQVUsRUFBRSxvQkFBVUMsTUFBVixFQUFrQjtBQUFBOztBQUM1QixpQkFBS25CLElBQUwsR0FBWSxZQUFaO0FBQ0EsaUJBQUttQixNQUFMLEdBQWNBLE1BQWQ7QUFDQSxpQkFBS0Msa0JBQUwsR0FBMEIsS0FBMUI7QUFFQSxpQkFBS0MsTUFBTCxHQUFjLEtBQWQ7O0FBRUEsaUJBQUtDLFNBQUwsR0FBaUI7QUFBQSxxQkFBTztBQUN0QlosZ0JBQUFBLElBQUksRUFBRSxjQUFBQyxTQUFTO0FBQUEseUJBQUlDLFlBQVksQ0FBQztBQUFBLDJCQUFNRCxTQUFTLENBQUUsTUFBSSxDQUFDVSxNQUFMLElBQWUsTUFBSSxDQUFDQSxNQUFMLENBQVlFLE1BQTVCLElBQXVDLENBQXhDLENBQWY7QUFBQSxtQkFBRCxDQUFoQjtBQUFBO0FBRE8sZUFBUDtBQUFBLGFBQWpCOztBQUlBLGlCQUFLQyxTQUFMLEdBQWlCLFVBQUFDLE1BQU0sRUFBSTtBQUN6QixtQkFBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBUixFQUFXQyxHQUFHLEdBQUcsTUFBSSxDQUFDTixNQUFMLENBQVlFLE1BQWxDLEVBQTBDRyxDQUFDLEdBQUdDLEdBQTlDLEVBQW1ERCxDQUFDLEVBQXBELEVBQXdEO0FBQ3RERCxnQkFBQUEsTUFBTSxDQUFDQyxDQUFELENBQU4sR0FBWSxNQUFJLENBQUNMLE1BQUwsQ0FBWUssQ0FBWixDQUFaO0FBQ0Q7O0FBQ0QsY0FBQSxNQUFJLENBQUNMLE1BQUwsR0FBYyxLQUFkO0FBQ0QsYUFMRDtBQU1ELFdBbEJNO0FBbUJQTyxVQUFBQSxVQUFVLEVBQUUsb0JBQVVULE1BQVYsRUFBa0I7QUFBQTs7QUFDNUIsaUJBQUtuQixJQUFMLEdBQVksWUFBWjtBQUNBLGlCQUFLbUIsTUFBTCxHQUFjQSxNQUFkO0FBQ0EsaUJBQUtDLGtCQUFMLEdBQTBCLEtBQTFCO0FBRUEsaUJBQUtDLE1BQUwsR0FBYyxLQUFkOztBQUVBLGlCQUFLUSxVQUFMLEdBQWtCLFVBQUFDLElBQUksRUFBSTtBQUFFLGNBQUEsTUFBSSxDQUFDVCxNQUFMLEdBQWNTLElBQWQ7QUFBb0IsYUFBaEQ7O0FBRUEsaUJBQUtDLFVBQUwsR0FBa0I7QUFBQSxxQkFBTztBQUN2QnJCLGdCQUFBQSxJQUFJLEVBQUUsY0FBQUMsU0FBUztBQUFBLHlCQUFJQyxZQUFZLENBQUNELFNBQUQsQ0FBaEI7QUFBQTtBQURRLGVBQVA7QUFBQSxhQUFsQjtBQUdELFdBL0JNO0FBZ0NQcUIsVUFBQUEsa0JBQWtCLEVBQUU7QUFDbEJDLFlBQUFBLE9BQU8sRUFBRTtBQURTO0FBaENiO0FBREY7QUFqQ00sS0FBakI7QUF3RUQsR0F6RUssQ0FBTjtBQTJFQUMsRUFBQUEsVUFBVSxDQUFDLFVBQVV4QixJQUFWLEVBQWdCO0FBQ3pCakIsSUFBQUEsTUFBTSxHQUFHMEMsMEJBQVVDLElBQVYsQ0FBZSxXQUFmLEVBQTRCLElBQTVCLEVBQWtDO0FBQ3pDQyxNQUFBQSxrQkFBa0IsRUFBRTtBQURxQixLQUFsQyxDQUFUO0FBR0FDLElBQUFBLE1BQU0sQ0FBQzdDLE1BQUQsQ0FBTixDQUFlOEMsRUFBZixDQUFrQkMsS0FBbEI7O0FBRUEvQyxJQUFBQSxNQUFNLENBQUNnRCxNQUFQLEdBQWdCLFlBQVk7QUFDMUIvQixNQUFBQSxJQUFJO0FBQ0wsS0FGRDtBQUdELEdBVFMsQ0FBVjtBQVdBbEIsRUFBQUEsUUFBUSxDQUFDLGVBQUQsRUFBa0IsWUFBWTtBQUNwQ2tELElBQUFBLEVBQUUsQ0FBQyw4QkFBRCxFQUFpQyxVQUFVaEMsSUFBVixFQUFnQjtBQUNqRGpCLE1BQUFBLE1BQU0sQ0FBQ2tELE1BQVAsR0FBZ0IsVUFBVUMsQ0FBVixFQUFhO0FBQzNCTixRQUFBQSxNQUFNLENBQUMsSUFBSU8sVUFBSixDQUFlRCxDQUFDLENBQUNkLElBQWpCLENBQUQsQ0FBTixDQUErQlMsRUFBL0IsQ0FBa0NPLElBQWxDLENBQXVDQyxLQUF2QyxDQUE2QyxJQUFJRixVQUFKLENBQWUsQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsQ0FBZixDQUE3QztBQUNBcEQsUUFBQUEsTUFBTSxDQUFDdUQsS0FBUDtBQUNELE9BSEQ7O0FBSUF2RCxNQUFBQSxNQUFNLENBQUN3RCxPQUFQLEdBQWlCO0FBQUEsZUFBTXZDLElBQUksRUFBVjtBQUFBLE9BQWpCOztBQUVBakIsTUFBQUEsTUFBTSxDQUFDeUQsV0FBUCxDQUFtQjdCLE1BQW5CLEdBQTRCLElBQUl3QixVQUFKLENBQWUsQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsQ0FBZixDQUE1QjtBQUNELEtBUkMsQ0FBRjtBQVNELEdBVk8sQ0FBUjtBQVlBckQsRUFBQUEsUUFBUSxDQUFDLE9BQUQsRUFBVSxZQUFZO0FBQzVCa0QsSUFBQUEsRUFBRSxDQUFDLGFBQUQsRUFBZ0IsVUFBVWhDLElBQVYsRUFBZ0I7QUFDaENqQixNQUFBQSxNQUFNLENBQUN3RCxPQUFQLEdBQWlCLFlBQVk7QUFDM0JYLFFBQUFBLE1BQU0sQ0FBQzdDLE1BQU0sQ0FBQzBELFVBQVIsQ0FBTixDQUEwQlosRUFBMUIsQ0FBNkJRLEtBQTdCLENBQW1DLFFBQW5DO0FBQ0FyQyxRQUFBQSxJQUFJO0FBQ0wsT0FIRDs7QUFLQWpCLE1BQUFBLE1BQU0sQ0FBQ3VELEtBQVA7QUFDRCxLQVBDLENBQUY7QUFRRCxHQVRPLENBQVI7QUFXQXhELEVBQUFBLFFBQVEsQ0FBQyxNQUFELEVBQVMsWUFBWTtBQUMzQmtELElBQUFBLEVBQUUsQ0FBQyw0QkFBRCxFQUErQixVQUFVaEMsSUFBVixFQUFnQjtBQUMvQ2pCLE1BQUFBLE1BQU0sQ0FBQzJELE9BQVAsR0FBaUIsWUFBWTtBQUMzQjNELFFBQUFBLE1BQU0sQ0FBQ3VELEtBQVA7QUFDRCxPQUZEOztBQUdBdkQsTUFBQUEsTUFBTSxDQUFDd0QsT0FBUCxHQUFpQjtBQUFBLGVBQU12QyxJQUFJLEVBQVY7QUFBQSxPQUFqQjs7QUFFQWpCLE1BQUFBLE1BQU0sQ0FBQzRELElBQVAsQ0FBWSxJQUFJUixVQUFKLENBQWUsQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsQ0FBZixFQUEwQlMsTUFBdEM7QUFDRCxLQVBDLENBQUY7QUFRRCxHQVRPLENBQVI7QUFVRCxDQTFITyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLWV4cHJlc3Npb25zICovXG5cbmltcG9ydCBUY3BTb2NrZXQgZnJvbSAnLi93aW5kb3dzLXNvY2tldCdcblxuZGVzY3JpYmUoJ1RDUFNvY2tldCBXaW5kb3dzIFN0cmVhbSBTb2NrZXQgdW5pdCB0ZXN0cycsIGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNvY2tldFxuXG4gIGJlZm9yZSgoKSA9PiB7XG4gICAgZ2xvYmFsLldpbmRvd3MgPSB7XG4gICAgICBOZXR3b3JraW5nOiB7XG4gICAgICAgIEhvc3ROYW1lOiBmdW5jdGlvbiAoaG9zdG5hbWUpIHtcbiAgICAgICAgICB0aGlzLnR5cGUgPSBob3N0bmFtZVxuICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZVxuICAgICAgICB9LFxuICAgICAgICBTb2NrZXRzOiB7XG4gICAgICAgICAgU3RyZWFtU29ja2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRyb2wgPSB7fVxuXG4gICAgICAgICAgICB0aGlzLmlucHV0U3RyZWFtID0ge1xuICAgICAgICAgICAgICB0eXBlOiAnaW5wdXRTdHJlYW0nXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMub3V0cHV0U3RyZWFtID0ge1xuICAgICAgICAgICAgICB0eXBlOiAnb3V0cHV0U3RyZWFtJ1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3RBc3luYyA9IChob3N0LCBwb3J0LCBwcm90ZWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuaG9zdCA9IGhvc3RcbiAgICAgICAgICAgICAgdGhpcy5wb3J0ID0gcG9ydFxuICAgICAgICAgICAgICB0aGlzLnByb3RlY3Rpb24gPSBwcm90ZWN0aW9uXG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZG9uZTogc3VjY2Vzc0NiID0+IHNldEltbWVkaWF0ZShzdWNjZXNzQ2IpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFNvY2tldFByb3RlY3Rpb25MZXZlbDoge1xuICAgICAgICAgICAgcGxhaW5Tb2NrZXQ6IDEsXG4gICAgICAgICAgICB0bHMxMjogMlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFN0b3JhZ2U6IHtcbiAgICAgICAgU3RyZWFtczoge1xuICAgICAgICAgIERhdGFSZWFkZXI6IGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9ICdEYXRhUmVhZGVyJ1xuICAgICAgICAgICAgdGhpcy5zdHJlYW0gPSBzdHJlYW1cbiAgICAgICAgICAgIHRoaXMuaW5wdXRTdHJlYW1PcHRpb25zID0gZmFsc2VcblxuICAgICAgICAgICAgdGhpcy5fYnl0ZXMgPSBmYWxzZVxuXG4gICAgICAgICAgICB0aGlzLmxvYWRBc3luYyA9ICgpID0+ICh7XG4gICAgICAgICAgICAgIGRvbmU6IHN1Y2Nlc3NDYiA9PiBzZXRJbW1lZGlhdGUoKCkgPT4gc3VjY2Vzc0NiKCh0aGlzLl9ieXRlcyAmJiB0aGlzLl9ieXRlcy5sZW5ndGgpIHx8IDApKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgdGhpcy5yZWFkQnl0ZXMgPSB0YXJnZXQgPT4ge1xuICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fYnl0ZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRbaV0gPSB0aGlzLl9ieXRlc1tpXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRoaXMuX2J5dGVzID0gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIERhdGFXcml0ZXI6IGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9ICdEYXRhV3JpdGVyJ1xuICAgICAgICAgICAgdGhpcy5zdHJlYW0gPSBzdHJlYW1cbiAgICAgICAgICAgIHRoaXMuaW5wdXRTdHJlYW1PcHRpb25zID0gZmFsc2VcblxuICAgICAgICAgICAgdGhpcy5fYnl0ZXMgPSBmYWxzZVxuXG4gICAgICAgICAgICB0aGlzLndyaXRlQnl0ZXMgPSBkYXRhID0+IHsgdGhpcy5fYnl0ZXMgPSBkYXRhIH1cblxuICAgICAgICAgICAgdGhpcy5zdG9yZUFzeW5jID0gKCkgPT4gKHtcbiAgICAgICAgICAgICAgZG9uZTogc3VjY2Vzc0NiID0+IHNldEltbWVkaWF0ZShzdWNjZXNzQ2IpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0sXG4gICAgICAgICAgSW5wdXRTdHJlYW1PcHRpb25zOiB7XG4gICAgICAgICAgICBwYXJ0aWFsOiAzXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KVxuXG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKGRvbmUpIHtcbiAgICBzb2NrZXQgPSBUY3BTb2NrZXQub3BlbignMTI3LjAuMC4xJywgOTAwMCwge1xuICAgICAgdXNlU2VjdXJlVHJhbnNwb3J0OiBmYWxzZVxuICAgIH0pXG4gICAgZXhwZWN0KHNvY2tldCkudG8uZXhpc3RcblxuICAgIHNvY2tldC5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICBkb25lKClcbiAgICB9XG4gIH0pXG5cbiAgZGVzY3JpYmUoJ29wZW4gYW5kIHJlYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZWFkIGRhdGEgZnJvbSBzb2NrZXQnLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgc29ja2V0Lm9uZGF0YSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGV4cGVjdChuZXcgVWludDhBcnJheShlLmRhdGEpKS50by5kZWVwLmVxdWFsKG5ldyBVaW50OEFycmF5KFswLCAxLCAyXSkpXG4gICAgICAgIHNvY2tldC5jbG9zZSgpXG4gICAgICB9XG4gICAgICBzb2NrZXQub25jbG9zZSA9ICgpID0+IGRvbmUoKVxuXG4gICAgICBzb2NrZXQuX2RhdGFSZWFkZXIuX2J5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDEsIDJdKVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ2Nsb3NlJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgd29yaycsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICBzb2NrZXQub25jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZXhwZWN0KHNvY2tldC5yZWFkeVN0YXRlKS50by5lcXVhbCgnY2xvc2VkJylcbiAgICAgICAgZG9uZSgpXG4gICAgICB9XG5cbiAgICAgIHNvY2tldC5jbG9zZSgpXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnc2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgZGF0YSB0byBzb2NrZXQnLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgc29ja2V0Lm9uZHJhaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNvY2tldC5jbG9zZSgpXG4gICAgICB9XG4gICAgICBzb2NrZXQub25jbG9zZSA9ICgpID0+IGRvbmUoKVxuXG4gICAgICBzb2NrZXQuc2VuZChuZXcgVWludDhBcnJheShbMCwgMSwgMl0pLmJ1ZmZlcilcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==